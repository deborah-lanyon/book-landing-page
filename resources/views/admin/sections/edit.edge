<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Section - Admin Panel</title>
  <script src="https://cdn.tiny.cloud/1/wogn0yqjl4fxgrix10q3xfhojxskfvu2yrz0to24d6v4ke9i/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .header { background: #2c3e50; color: white; padding: 20px 0; margin-bottom: 30px; }
    .header h1 { margin: 0; font-size: 24px; }
    .btn { display: inline-block; padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; font-size: 14px; }
    .btn:hover { background: #2980b9; }
    .btn-secondary { background: #95a5a6; }
    .btn-secondary:hover { background: #7f8c8d; }
    .card { background: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
    .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
    textarea.form-control { min-height: 150px; resize: vertical; }
    .checkbox-group { display: flex; align-items: center; }
    .checkbox-group input { width: auto; margin-right: 8px; }
    .alert { padding: 15px; margin-bottom: 20px; border-radius: 4px; }
    .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
  </style>
</head>
<body>
  <div class="header">
    <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
      <h1>Miriam's Home - Admin Panel</h1>
      <div style="display: flex; gap: 10px; align-items: center;">
        <a href="/" class="btn" style="padding: 8px 16px;" target="_blank">View Public Page</a>
        <a href="{{ route('admin.settings.edit') }}" class="btn btn-secondary" style="padding: 8px 16px;" target="_blank">Site Settings</a>
        <a href="{{ route('admin.password.edit') }}" class="btn btn-secondary" style="padding: 8px 16px;" target="_blank">Change Password</a>
        <form method="POST" action="/logout" style="margin: 0;">
          <input type="hidden" name="_csrf" value="{{ csrfToken }}">
          <button type="submit" class="btn btn-secondary" style="padding: 8px 16px;">Logout</button>
        </form>
      </div>
    </div>
  </div>
  <div class="container">
    @if(flashMessages.has('errors'))
      <div class="alert alert-error">
        <strong>Validation errors:</strong>
        <ul style="margin: 10px 0 0 0; padding-left: 20px;">
          @each(error in flashMessages.get('errors'))
            <li>{{ error.message }}</li>
          @end
        </ul>
      </div>
    @end

    <div class="card">
      <h2 style="margin-top: 0;">Edit Accordion Section</h2>
      <form id="section-form" method="POST" action="/admin/sections/{{ section.id }}">
        <input type="hidden" name="_csrf" value="{{ csrfToken }}">
        <input type="hidden" name="_method" value="PUT">
        <div class="form-group">
          <label for="title">Section Heading *</label>
          <input type="text" id="title" name="title" class="form-control" value="{{ section.title }}" required placeholder="e.g., Introduction, Chapter 1, About the Author">
        </div>
        <div class="form-group">
          <label for="reflectiveQuestion">Reflective Question 1</label>
          <input type="text" id="reflectiveQuestion" name="reflectiveQuestion" class="form-control" value="{{ section.reflectiveQuestion || '' }}" placeholder="e.g., What does this mean to you?">
        </div>
        <div class="form-group">
          <label for="reflectiveQuestion2">Reflective Question 2</label>
          <input type="text" id="reflectiveQuestion2" name="reflectiveQuestion2" class="form-control" value="{{ section.reflectiveQuestion2 || '' }}" placeholder="Optional second reflective question">
        </div>
        <div class="form-group">
          <label for="reflectiveQuestion3">Reflective Question 3</label>
          <input type="text" id="reflectiveQuestion3" name="reflectiveQuestion3" class="form-control" value="{{ section.reflectiveQuestion3 || '' }}" placeholder="Optional third reflective question">
        </div>
        <div class="form-group">
          <label for="content">Section Content *</label>
          <textarea id="content" name="content" class="form-control" required placeholder="Enter the content that will be displayed when this section is expanded...">{{ section.content }}</textarea>
        </div>
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="isPublished" name="isPublished" value="true" @if(section.isPublished) checked @end>
            <label for="isPublished" style="margin-bottom: 0; font-weight: normal;">Publish this section (visible on public page)</label>
          </div>
        </div>
        <div style="display: flex; gap: 10px;">
          <button type="submit" class="btn">Update Section</button>
          <a href="/admin/sections" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    tinymce.init({
      selector: '#content',
      height: 400,
      plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
      toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
      menubar: 'file edit view insert format tools table',
      content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 14px; }',
      image_title: true,
      automatic_uploads: false,
      file_picker_types: 'image',
      images_upload_handler: function (blobInfo, progress) {
        return new Promise(function (resolve, reject) {
          var reader = new FileReader();
          reader.onload = function () {
            resolve(reader.result);
          };
          reader.onerror = function () {
            reject('Failed to read file');
          };
          reader.readAsDataURL(blobInfo.blob());
        });
      },
      setup: function (editor) {
        editor.on('change', function () {
          tinymce.triggerSave();
        });
      }
    });

    // Sync TinyMCE content before form submit
    document.getElementById('section-form').addEventListener('submit', function () {
      tinymce.triggerSave();
    });
  </script>
</body>
</html>
