<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Settings - Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
  @!component('partials/admin-sidebar-styles')
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #3498db;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover {
      background: #2980b9;
    }
    .btn-secondary {
      background: #95a5a6;
    }
    .btn-secondary:hover {
      background: #7f8c8d;
    }
    .btn-success {
      background: #27ae60;
    }
    .btn-success:hover {
      background: #219a52;
    }
    .btn-small {
      padding: 6px 12px;
      font-size: 13px;
    }
    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .nav-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    /* Side-by-side pairs layout */
    .content-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      overflow: hidden;
    }
    .section-title {
      background: #2c3e50;
      color: white;
      padding: 12px 20px;
      font-weight: 600;
      font-size: 16px;
    }
    .section-body {
      padding: 20px;
    }

    /* Field pair row */
    .field-pair {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    .field-pair:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    .field-side {
      min-width: 0;
    }
    .field-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .field-label {
      font-weight: 500;
      font-size: 13px;
      color: #555;
    }
    .lang-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .lang-badge.english {
      background: #3498db;
      color: white;
    }
    .lang-badge.indonesian {
      background: #27ae60;
      color: white;
    }
    .form-control {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .translation-input {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
    }
    .quill-container {
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .quill-container .ql-container {
      min-height: 150px;
      font-size: 14px;
    }
    .quill-container .ql-editor {
      min-height: 150px;
    }
    .quill-readonly {
      background: #f8f9fa;
    }

    @media (max-width: 900px) {
      .field-pair {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <button class="sidebar-toggle" onclick="document.querySelector('.admin-sidebar').classList.toggle('open');document.querySelector('.sidebar-overlay').classList.toggle('open');">&#9776;</button>
  <div class="sidebar-overlay" onclick="document.querySelector('.admin-sidebar').classList.remove('open');this.classList.remove('open');"></div>
  <div class="admin-layout">
    @!component('partials/admin-sidebar', { activeMenu: 'settings' })
    <div class="admin-main">
      <div class="container">
    @if(flashMessages.has('success'))
      <div class="alert alert-success">
        {{ flashMessages.get('success') }}
      </div>
    @end

    @if(translationError)
      <div class="alert alert-error">
        Translation Error: {{ translationError }}
      </div>
    @end

    <div class="nav-buttons">
      <h1 style="margin: 0; font-size: 24px; color: #2c3e50;">Site Settings</h1>
      <button type="button" class="btn btn-success" onclick="saveAllTranslations()" style="margin-left: auto;">Save All Translations</button>
    </div>

    <p style="color: #666; margin-bottom: 20px;">
      Edit content in English (left), Indonesian translations appear on the right.
      The Indonesian content will be used as the source for the public page.
    </p>

    <!-- About Us Section -->
    <div class="content-section">
      <div class="section-title">About Us Section</div>
      <div class="section-body">
        <form id="about-form" method="POST" action="{{ route('admin.settings.update') }}">
          <input type="hidden" name="_csrf" value="{{ csrfToken }}">
          <input type="hidden" name="_method" value="PUT">

          <!-- About Us Title -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">About Us Title</span>
              </div>
              <input type="text" id="about_us_title" name="about_us_title" class="form-control" value="{{ aboutUsTitle }}" placeholder="e.g., About Us">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">About Us Title</span>
              </div>
              <input type="text" id="about_us_title_id" class="form-control translation-input" value="{{ aboutUsTitleTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- About Us Content -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">About Us Content</span>
              </div>
              <div id="about-us-editor" class="quill-container">{{{ aboutUsContent }}}</div>
              <input type="hidden" id="about_us_content" name="about_us_content">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">About Us Content</span>
              </div>
              <div id="about-us-editor-id" class="quill-container quill-readonly">{{{ aboutUsContentTranslated }}}</div>
            </div>
          </div>

          <button type="submit" class="btn btn-success btn-small">Save About Us</button>
        </form>
      </div>
    </div>

    <!-- Contact Form Section -->
    <div class="content-section">
      <div class="section-title">Contact Form Labels</div>
      <div class="section-body">
        <form id="form-settings-form" method="POST" action="{{ route('admin.settings.update') }}">
          <input type="hidden" name="_csrf" value="{{ csrfToken }}">
          <input type="hidden" name="_method" value="PUT">
          <!-- Preserve About Us fields -->
          <input type="hidden" name="about_us_title" value="{{ aboutUsTitle }}">
          <input type="hidden" id="form-about-us-content" name="about_us_content" value="">

          <!-- Form Title -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Form Title</span>
              </div>
              <input type="text" id="form_title" name="form_title" class="form-control" value="{{ formTitle }}" placeholder="e.g., Get In Touch">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Form Title</span>
              </div>
              <input type="text" id="form_title_id" class="form-control translation-input" value="{{ formTitleTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- First Name Label -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">First Name Label</span>
              </div>
              <input type="text" id="form_first_name_label" name="form_first_name_label" class="form-control" value="{{ formFirstNameLabel }}" placeholder="e.g., First Name">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">First Name Label</span>
              </div>
              <input type="text" id="form_first_name_label_id" class="form-control translation-input" value="{{ formFirstNameLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Last Name Label -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Last Name Label</span>
              </div>
              <input type="text" id="form_last_name_label" name="form_last_name_label" class="form-control" value="{{ formLastNameLabel }}" placeholder="e.g., Last Name">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Last Name Label</span>
              </div>
              <input type="text" id="form_last_name_label_id" class="form-control translation-input" value="{{ formLastNameLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Town Label -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Town Label</span>
              </div>
              <input type="text" id="form_town_label" name="form_town_label" class="form-control" value="{{ formTownLabel }}" placeholder="e.g., Town">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Town Label</span>
              </div>
              <input type="text" id="form_town_label_id" class="form-control translation-input" value="{{ formTownLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Email Label -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Email Label</span>
              </div>
              <input type="text" id="form_email_label" name="form_email_label" class="form-control" value="{{ formEmailLabel }}" placeholder="e.g., Email">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Email Label</span>
              </div>
              <input type="text" id="form_email_label_id" class="form-control translation-input" value="{{ formEmailLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Would You Like Label -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Would You Like Label</span>
              </div>
              <input type="text" id="form_would_like_label" name="form_would_like_label" class="form-control" value="{{ formWouldLikeLabel }}" placeholder="e.g., Would you like">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Would You Like Label</span>
              </div>
              <input type="text" id="form_would_like_label_id" class="form-control translation-input" value="{{ formWouldLikeLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Follow Jesus Option -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Follow Jesus Option</span>
              </div>
              <input type="text" id="form_follow_jesus_label" name="form_follow_jesus_label" class="form-control" value="{{ formFollowJesusLabel }}" placeholder="e.g., Further information on how to become a follower of Jesus Christ">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Follow Jesus Option</span>
              </div>
              <input type="text" id="form_follow_jesus_label_id" class="form-control translation-input" value="{{ formFollowJesusLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Bible Option -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Bible Option</span>
              </div>
              <input type="text" id="form_bible_label" name="form_bible_label" class="form-control" value="{{ formBibleLabel }}" placeholder="e.g., A Bible in your own language">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Bible Option</span>
              </div>
              <input type="text" id="form_bible_label_id" class="form-control translation-input" value="{{ formBibleLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Prayer Request Option -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Prayer Request Option</span>
              </div>
              <input type="text" id="form_prayer_label" name="form_prayer_label" class="form-control" value="{{ formPrayerLabel }}" placeholder="e.g., Share a prayer request">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Prayer Request Option</span>
              </div>
              <input type="text" id="form_prayer_label_id" class="form-control translation-input" value="{{ formPrayerLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Ask Question Option -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Ask Question Option</span>
              </div>
              <input type="text" id="form_question_label" name="form_question_label" class="form-control" value="{{ formQuestionLabel }}" placeholder="e.g., Ask a question">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Ask Question Option</span>
              </div>
              <input type="text" id="form_question_label_id" class="form-control translation-input" value="{{ formQuestionLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Message Label -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Message Label</span>
              </div>
              <input type="text" id="form_message_label" name="form_message_label" class="form-control" value="{{ formMessageLabel }}" placeholder="e.g., Your Question or Feedback">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Message Label</span>
              </div>
              <input type="text" id="form_message_label_id" class="form-control translation-input" value="{{ formMessageLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <!-- Submit Button Label -->
          <div class="field-pair">
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge english">EN</span>
                <span class="field-label">Submit Button Label</span>
              </div>
              <input type="text" id="form_submit_label" name="form_submit_label" class="form-control" value="{{ formSubmitLabel }}" placeholder="e.g., Send Message">
            </div>
            <div class="field-side">
              <div class="field-header">
                <span class="lang-badge indonesian">ID</span>
                <span class="field-label">Submit Button Label</span>
              </div>
              <input type="text" id="form_submit_label_id" class="form-control translation-input" value="{{ formSubmitLabelTranslated }}" placeholder="Indonesian translation...">
            </div>
          </div>

          <button type="submit" class="btn btn-success btn-small">Save Form Labels</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Hidden form for saving translations -->
  <form id="translations-form" method="POST" action="{{ route('admin.settings.saveTranslations') }}" style="display: none;">
    <input type="hidden" name="_csrf" value="{{ csrfToken }}">
    <input type="hidden" id="form_about_us_title_id" name="about_us_title_id">
    <input type="hidden" id="form_about_us_content_id" name="about_us_content_id">
    <!-- Form translations -->
    <input type="hidden" id="form_form_title_id" name="form_title_id">
    <input type="hidden" id="form_form_first_name_label_id" name="form_first_name_label_id">
    <input type="hidden" id="form_form_last_name_label_id" name="form_last_name_label_id">
    <input type="hidden" id="form_form_town_label_id" name="form_town_label_id">
    <input type="hidden" id="form_form_email_label_id" name="form_email_label_id">
    <input type="hidden" id="form_form_would_like_label_id" name="form_would_like_label_id">
    <input type="hidden" id="form_form_follow_jesus_label_id" name="form_follow_jesus_label_id">
    <input type="hidden" id="form_form_bible_label_id" name="form_bible_label_id">
    <input type="hidden" id="form_form_prayer_label_id" name="form_prayer_label_id">
    <input type="hidden" id="form_form_question_label_id" name="form_question_label_id">
    <input type="hidden" id="form_form_message_label_id" name="form_message_label_id">
    <input type="hidden" id="form_form_submit_label_id" name="form_submit_label_id">
  </form>

  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
  <script>
    // Quill toolbar configuration
    var toolbarOptions = [
      ['bold', 'italic', 'underline'],
      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
      ['link', 'image'],
      ['clean']
    ];

    // English editor for About Us
    var aboutUsQuill = new Quill('#about-us-editor', {
      theme: 'snow',
      modules: { toolbar: toolbarOptions },
      placeholder: 'Enter About Us content here...'
    });

    // Indonesian editor for About Us
    var aboutUsQuillId = new Quill('#about-us-editor-id', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link'],
          ['clean']
        ]
      },
      placeholder: 'Indonesian translation...'
    });

    // Custom image handler
    function addImageHandler(quillInstance) {
      quillInstance.getModule('toolbar').addHandler('image', function() {
        var input = document.createElement('input');
        input.setAttribute('type', 'file');
        input.setAttribute('accept', 'image/*');
        input.click();
        input.onchange = function() {
          var file = input.files[0];
          if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
              var range = quillInstance.getSelection(true);
              quillInstance.insertEmbed(range.index, 'image', e.target.result);
            };
            reader.readAsDataURL(file);
          }
        };
      });
    }

    addImageHandler(aboutUsQuill);

    // Sync Quill content before form submit (About section)
    document.getElementById('about-form').addEventListener('submit', function () {
      document.getElementById('about_us_content').value = aboutUsQuill.root.innerHTML;
    });

    // Sync Quill content before form submit (Form settings section)
    document.getElementById('form-settings-form').addEventListener('submit', function () {
      document.getElementById('form-about-us-content').value = aboutUsQuill.root.innerHTML;
    });

    // Save all Indonesian translations
    function saveAllTranslations() {
      // About Us translations
      document.getElementById('form_about_us_title_id').value = document.getElementById('about_us_title_id').value;
      document.getElementById('form_about_us_content_id').value = aboutUsQuillId.root.innerHTML;

      // Form translations
      document.getElementById('form_form_title_id').value = document.getElementById('form_title_id').value;
      document.getElementById('form_form_first_name_label_id').value = document.getElementById('form_first_name_label_id').value;
      document.getElementById('form_form_last_name_label_id').value = document.getElementById('form_last_name_label_id').value;
      document.getElementById('form_form_town_label_id').value = document.getElementById('form_town_label_id').value;
      document.getElementById('form_form_email_label_id').value = document.getElementById('form_email_label_id').value;
      document.getElementById('form_form_would_like_label_id').value = document.getElementById('form_would_like_label_id').value;
      document.getElementById('form_form_follow_jesus_label_id').value = document.getElementById('form_follow_jesus_label_id').value;
      document.getElementById('form_form_bible_label_id').value = document.getElementById('form_bible_label_id').value;
      document.getElementById('form_form_prayer_label_id').value = document.getElementById('form_prayer_label_id').value;
      document.getElementById('form_form_question_label_id').value = document.getElementById('form_question_label_id').value;
      document.getElementById('form_form_message_label_id').value = document.getElementById('form_message_label_id').value;
      document.getElementById('form_form_submit_label_id').value = document.getElementById('form_submit_label_id').value;

      document.getElementById('translations-form').submit();
    }
  </script>
    </div>
  </div>
</body>
</html>
