<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Settings - Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .header { background: #2c3e50; color: white; padding: 20px 0; margin-bottom: 30px; }
    .header h1 { margin: 0; font-size: 24px; }
    .btn { display: inline-block; padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; font-size: 14px; }
    .btn:hover { background: #2980b9; }
    .btn-secondary { background: #95a5a6; }
    .btn-secondary:hover { background: #7f8c8d; }
    .btn-success { background: #27ae60; }
    .btn-success:hover { background: #219a52; }
    .card { background: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
    .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
    .alert { padding: 15px; margin-bottom: 20px; border-radius: 4px; }
    .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .header-content { display: flex; justify-content: space-between; align-items: center; }
    .header-buttons { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

    /* Bilingual layout */
    .bilingual-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
    .language-column { }
    .language-header {
      background: #34495e;
      color: white;
      padding: 10px 15px;
      border-radius: 4px 4px 0 0;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .language-header.english { background: #2980b9; }
    .language-header.indonesian { background: #27ae60; }
    .language-content {
      background: white;
      padding: 20px;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 4px 4px;
    }

    .nav-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .refresh-btn { background: #e67e22; }
    .refresh-btn:hover { background: #d35400; }

    @media (max-width: 1024px) {
      .bilingual-container { grid-template-columns: 1fr; }
    }
    @media (max-width: 768px) {
      .header-content { flex-direction: column; gap: 15px; text-align: center; }
      .header-buttons { justify-content: center; }
      .header h1 { font-size: 20px; }
      .btn { padding: 8px 12px; font-size: 13px; }
      .container { padding: 15px; }
      .card { padding: 15px; }
    }
    @media (max-width: 480px) {
      .header-buttons { flex-direction: column; width: 100%; }
      .header-buttons .btn, .header-buttons form { width: 100%; }
      .header-buttons form button { width: 100%; }
      .nav-buttons { flex-direction: column; }
      .nav-buttons .btn { width: 100%; text-align: center; }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="container header-content">
      <h1>Miriam's Home - Site Settings</h1>
      <div class="header-buttons">
        <a href="/" class="btn" target="_blank">View Public Page</a>
        <a href="{{ route('admin.bilingual.index') }}" class="btn btn-secondary">Bilingual Editor</a>
        <a href="{{ route('admin.users.index') }}" class="btn btn-secondary">Manage Users</a>
        <form method="POST" action="/logout" style="margin: 0;">
          <input type="hidden" name="_csrf" value="{{ csrfToken }}">
          <button type="submit" class="btn btn-secondary">Logout</button>
        </form>
      </div>
    </div>
  </div>
  <div class="container">
    @if(flashMessages.has('success'))
      <div class="alert alert-success">
        {{ flashMessages.get('success') }}
      </div>
    @end

    @if(translationError)
      <div class="alert alert-error">
        Translation Error: {{ translationError }}
      </div>
    @end

    <div class="nav-buttons">
      <a href="{{ route('admin.settings.edit') }}?refresh=1" class="btn refresh-btn">Refresh Translations from API</a>
      <button type="button" class="btn btn-success" onclick="saveAllTranslations()">Save All Translations</button>
    </div>

    <p style="color: #666; margin-bottom: 20px;">
      Edit content in English (left column). Indonesian translations are automatically generated (right column).
      <br>The Indonesian content will be used as the source for the public page and can be translated to other languages.
    </p>

    <!-- Header Section -->
    <h3 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">Header Section</h3>

    <div class="bilingual-container">
      <!-- English Column -->
      <div class="language-column">
        <div class="language-header english">
          English (Edit)
        </div>
        <div class="language-content">
          <form id="settings-form" method="POST" action="{{ route('admin.settings.update') }}">
            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
            <input type="hidden" name="_method" value="PUT">

            <div class="form-group">
              <label for="welcome_title">Welcome Title</label>
              <input type="text" id="welcome_title" name="welcome_title" class="form-control" value="{{ welcomeTitle }}" required placeholder="e.g., Welcome">
            </div>

            <div class="form-group">
              <label>Welcome Subtitle</label>
              <div id="subtitle-editor" style="height: 150px; background: white;">{{{ welcomeSubtitle }}}</div>
              <input type="hidden" id="welcome_subtitle" name="welcome_subtitle">
            </div>

            <button type="submit" class="btn">Save English Content</button>
          </form>
        </div>
      </div>

      <!-- Indonesian Column -->
      <div class="language-column">
        <div class="language-header indonesian">
          Indonesian (Translation Preview)
        </div>
        <div class="language-content">
          <div class="form-group">
            <label>Welcome Title (Indonesian)</label>
            <input type="text" id="welcome_title_id" class="form-control translation-field" value="{{ welcomeTitleTranslated }}" placeholder="Indonesian translation...">
          </div>

          <div class="form-group">
            <label>Welcome Subtitle (Indonesian)</label>
            <div id="subtitle-editor-id" style="height: 150px; background: white;">{{{ welcomeSubtitleTranslated }}}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- About Us Section -->
    <h3 style="margin-top: 30px; margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">About Us Section</h3>

    <div class="bilingual-container">
      <!-- English Column -->
      <div class="language-column">
        <div class="language-header english">
          English (Edit)
        </div>
        <div class="language-content">
          <form id="about-form" method="POST" action="{{ route('admin.settings.update') }}">
            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
            <input type="hidden" name="_method" value="PUT">
            <!-- Include all fields so they don't get cleared -->
            <input type="hidden" name="welcome_title" value="{{ welcomeTitle }}">
            <input type="hidden" id="about-welcome-subtitle" name="welcome_subtitle" value="">

            <div class="form-group">
              <label for="about_us_title">About Us Title</label>
              <input type="text" id="about_us_title" name="about_us_title" class="form-control" value="{{ aboutUsTitle }}" placeholder="e.g., About Us">
            </div>

            <div class="form-group">
              <label>About Us Content</label>
              <div id="about-us-editor" style="height: 200px; background: white;">{{{ aboutUsContent }}}</div>
              <input type="hidden" id="about_us_content" name="about_us_content">
            </div>

            <button type="submit" class="btn">Save English Content</button>
          </form>
        </div>
      </div>

      <!-- Indonesian Column -->
      <div class="language-column">
        <div class="language-header indonesian">
          Indonesian (Translation Preview)
        </div>
        <div class="language-content">
          <div class="form-group">
            <label>About Us Title (Indonesian)</label>
            <input type="text" id="about_us_title_id" class="form-control translation-field" value="{{ aboutUsTitleTranslated }}" placeholder="Indonesian translation...">
          </div>

          <div class="form-group">
            <label>About Us Content (Indonesian)</label>
            <div id="about-us-editor-id" style="height: 200px; background: white;">{{{ aboutUsContentTranslated }}}</div>
          </div>
        </div>
      </div>
    </div>

    <div style="margin-top: 20px; display: flex; gap: 10px;">
      <a href="{{ route('admin.bilingual.index') }}" class="btn btn-secondary">Back to Bilingual Editor</a>
    </div>
  </div>

  <!-- Hidden form for saving translations -->
  <form id="translations-form" method="POST" action="{{ route('admin.settings.saveTranslations') }}" style="display: none;">
    <input type="hidden" name="_csrf" value="{{ csrfToken }}">
    <input type="hidden" id="form_welcome_title_id" name="welcome_title_id">
    <input type="hidden" id="form_welcome_subtitle_id" name="welcome_subtitle_id">
    <input type="hidden" id="form_about_us_title_id" name="about_us_title_id">
    <input type="hidden" id="form_about_us_content_id" name="about_us_content_id">
  </form>

  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
  <script>
    // English editors
    var subtitleQuill = new Quill('#subtitle-editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link', 'image'],
          ['clean']
        ]
      },
      placeholder: 'e.g., Tap any section below to learn more'
    });

    var aboutUsQuill = new Quill('#about-us-editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link', 'image'],
          ['clean']
        ]
      },
      placeholder: 'Enter About Us content here...'
    });

    // Indonesian editors (read-only for preview, but editable for corrections)
    var subtitleQuillId = new Quill('#subtitle-editor-id', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link'],
          ['clean']
        ]
      },
      placeholder: 'Indonesian translation will appear here...'
    });

    var aboutUsQuillId = new Quill('#about-us-editor-id', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link'],
          ['clean']
        ]
      },
      placeholder: 'Indonesian translation will appear here...'
    });

    // Custom image handler for English editors
    function addImageHandler(quillInstance) {
      quillInstance.getModule('toolbar').addHandler('image', function() {
        var input = document.createElement('input');
        input.setAttribute('type', 'file');
        input.setAttribute('accept', 'image/*');
        input.click();
        input.onchange = function() {
          var file = input.files[0];
          if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
              var range = quillInstance.getSelection(true);
              quillInstance.insertEmbed(range.index, 'image', e.target.result);
            };
            reader.readAsDataURL(file);
          }
        };
      });
    }

    addImageHandler(subtitleQuill);
    addImageHandler(aboutUsQuill);

    // Sync Quill content before form submit (Header section)
    document.getElementById('settings-form').addEventListener('submit', function () {
      document.getElementById('welcome_subtitle').value = subtitleQuill.root.innerHTML;
    });

    // Sync Quill content before form submit (About section)
    document.getElementById('about-form').addEventListener('submit', function () {
      document.getElementById('about_us_content').value = aboutUsQuill.root.innerHTML;
      // Also sync the subtitle from the main editor
      document.getElementById('about-welcome-subtitle').value = subtitleQuill.root.innerHTML;
    });

    // Save all Indonesian translations
    function saveAllTranslations() {
      document.getElementById('form_welcome_title_id').value = document.getElementById('welcome_title_id').value;
      document.getElementById('form_welcome_subtitle_id').value = subtitleQuillId.root.innerHTML;
      document.getElementById('form_about_us_title_id').value = document.getElementById('about_us_title_id').value;
      document.getElementById('form_about_us_content_id').value = aboutUsQuillId.root.innerHTML;
      document.getElementById('translations-form').submit();
    }
  </script>
</body>
</html>
